---
# you can run 'ansible-playbook test.yml -K -e __update_etc_hosts_file=./test.hosts' for testing this role
- name: Test play
  hosts: localhost
  gather_facts: false

  vars:
    update_etc_hosts_list:
      - node_ip: 1.2.3.5
        node_name: host1
        node_domain: abc.de
        hana_something: whatever
      - node_ip: 1.2.3.7
        node_name: host1
        node_domain: abc.de
      - node_ip: 1.2.3.4
        node_name: host1
        node_domain: abc.de
        aliases:
          - alias1
          - anotheralias2
        node_comment: "Here comes text after hashsign"
        state: present
      - node_ip: 1.2.3.5
        state: absent

  tasks:
    - name: Remove dictionary entries
      ansible.builtin.set_fact:
        mydictlist_filtered: "{{ update_etc_hosts_list | reject('search', 'item.hana_something') | list }}"
        #mydictlist_filtered: "{{ update_etc_hosts_list |  map('combine', {'node_ip': item.node_ip, 'state': item.state|d('present')}) | list }}"
      loop: "{{ update_etc_hosts_list }}"

    - name: Debug variable mydictlist_filtered
      ansible.builtin.debug:
        var: mydictlist_filtered

